'use strict';

var objectClone = require('clone');
var commandGenerator = require('./../../helpers/commandGenerator');
var workerManager = require('./../../worker/manager');

/**
 * Clone repository into temporary directory.
 *
 * @param  {Object} data An object with options passed as an arguments to CLI (`.options`) and ProjectDescriptor instance (`.project`).
 */
module.exports = function cloneRepository(data) {
  return new Promise(function(resolve, reject) {
    var commandOptions = objectClone(data.options);
    var command = {
      command: commandGenerator('cloner', commandOptions),
      description: 'Cloning repository...',
    };

    workerManager([command], data.options, function(killed, workerOutput) {
      if (killed) {
        reject();
      } else {
        data.options.input = workerOutput.path;
        data.options.hasAutoGeneratedInput = true;

        resolve(data);
      }
    }, function() {
      reject();
    });
  });
}
